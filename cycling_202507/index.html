<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チャリコース | 2025年度 中学2年 キャンプ</title>
</head>
<body>
    <div class="top">
        <div class="bg">
            <div class="content">
                <img src="medias/cyclings/top1.jpg">
                <video src="medias/cyclings/top2.mp4"></video>
                <img src="medias/cyclings/top3.jpg">
            </div>
        </div>
        <div class="titles">
            <div class="logos">
                <div class="topLogos">
                    <img src="medias/logos/1/4.svg">
                    <img src="medias/logos/1/2.svg">
                    <img src="medias/logos/1/3.svg">
                    <img src="medias/logos/1/1.svg">
                    
                    <img src="medias/logos/2/2.svg">
                    <img src="medias/logos/2/1.svg">
                    
                    <img src="medias/logos/3/4.svg">
                    <img src="medias/logos/3/3.svg">
                    <img src="medias/logos/3/2.svg">
                    <img src="medias/logos/3/1.svg">
                </div>
                <div class="bottomLogos">
                    <img src="medias/logos/4/4.svg">
                    <img src="medias/logos/4/3.svg">
                    <img src="medias/logos/4/2.svg">
                    <img src="medias/logos/4/1.svg">

                    <img src="medias/logos/5/1.svg">
                    
                    <img src="medias/logos/6/3.svg">
                    <img src="medias/logos/6/1.svg">
                    <img src="medias/logos/6/2.svg">
                </div>
            </div>
        </div>
    </div>
    <div class="filter"></div>
    <div class="container">
        <div class="courses">
            <h1>テキスト</h1>
            <p>
                テキストテキストテキストテキストテキストテキストテキストテキストテキスト
            </p>
            <img src="medias/cyclings/container1.jpg">
        </div>
    </div>
    <style>
        body {
            margin: 0;
            font-family: "Outfit", "Outfit_Local", "Noto Sans JP", "SF Pro JP", "Arial", sans-serif;
        }
        .container {
            padding-top: 25vh;
            font-size: 1.5em;
            position: relative;
            z-index: 3;
        }
        .container div {
            padding: 10px;
            margin-bottom: 30vh;
        }
        .container img, .container video {
            max-width: 1000px;
            width: 100%;
            border-radius: 15px;
        }
        .filter {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        .top {
            height: 100vh;
            z-index: 1;
        }
        .top .bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .top .bg .content {
            transition: opacity 0.5s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: .5;
        }
        .top .bg img, .top .bg video {
            object-fit: cover;
            width: 100%;
            height: 100%;
            position: absolute;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
        }
        .top .titles {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }
        .top .titles .logos {
            position: relative;
            min-height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .top .titles .logos div {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .top .titles .logos img {
            position: absolute;
            object-fit: cover;
            width: 200%;
            max-width: 2000px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.05s ease-in-out;
        }
        .top .titles .logos div.bottomLogos img {
            width: 100%;
            max-width: 500px;
            margin-top: 45vh;
        }
        @keyframes logoDisplay {
            0% {
                opacity: 0;
                transform: translateY(-200px);
            }
            50% {
                opacity: 0;
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .logoDisplayAnimation {
            animation: logoDisplay 0.5s ease-in-out;
        }
    </style>
    <script>
        function clog (l) {console.log(l);}
        const d = document;

        const container     = d.querySelector(".container");
        const topTitles     = d.querySelector(".top .titles");
        const filter        = d.querySelector(".filter");
        const topBgContents = d.querySelector(".top .bg div.content");
        const topLogoImgs   = d.querySelectorAll(".top .titles .logos img");

        function getScrollTop () {
            return d.documentElement.scrollTop || d.body.scrollTop;
        }

        let isLogosAnimationRunning = false;

        function logosAnimation () {
            if (isLogosAnimationRunning) return;
            isLogosAnimationRunning = true;

            for (let i = 0; i < topLogoImgs.length; i += 1) {
                const logo = topLogoImgs[i];
                const animationTimeout = setTimeout(() => {
                    logo.classList.add("logoDisplayAnimation");
                    logo.style.opacity = 1;
                    clearTimeout(animationTimeout);
                }, i * 75);
                if (i === topLogoImgs.length - 1) {
                    const completedTimeout = setTimeout(() => {
                        isLogosAnimationRunning = false;
                        clearTimeout(completedTimeout);
                    }, i * 75 + 750);
                }
            }
        }

        Promise.all(Array.from(topLogoImgs).map(node => {
        return new Promise(resolve => {
            if (node.complete) {
                resolve();
            } else {
                node.addEventListener('load', resolve);
                node.addEventListener('error', resolve); // エラーでも完了扱いする場合
            }
        });
        })).then(() => {
            logosAnimation();
        });

        (() => {
            const topBgMedias = topBgContents.querySelectorAll("img, video");
            let displayIndex = 2;

            function exe () {               
                function isVideoElement (el) {
                    return el.tagName === "VIDEO";
                }
                
                const hiddenTargetIndex = displayIndex % topBgMedias.length;
                topBgMedias[hiddenTargetIndex].style.opacity = 0;

                if (isVideoElement(topBgMedias[hiddenTargetIndex])) {
                    topBgMedias[hiddenTargetIndex].muted = true;
                    const pauseDelayTimeout = setTimeout(() => {
                        topBgMedias[hiddenTargetIndex].pause();
                        clearTimeout(pauseDelayTimeout);
                    }, 500);
                }

                const displayTargetIndex = (displayIndex + 1) % topBgMedias.length;
                topBgMedias[displayTargetIndex].style.opacity = 1;

                if (isVideoElement(topBgMedias[displayTargetIndex])) {
                    topBgMedias[displayTargetIndex].muted = true;
                    topBgMedias[displayTargetIndex].play();
                }
                displayIndex += 1;
            }
            
            setInterval(() => exe(), 2500);
        })();

        const containerH1s = d.querySelectorAll(".container h1");
        containerH1s.forEach(h1 => {
            const text = h1.textContent;
            h1.innerHTML = "";
            text.split("").forEach((character, index) => {
                h1.innerHTML += `<span>${character}</span>`;
            });
        });

        function scrollEvent (e) {
            const scrollTop   = getScrollTop();
            const scrollRatio = scrollTop / d.body.scrollHeight;

            clog(`${scrollTop}\n${scrollRatio}`);

            const containerTexts = d.querySelectorAll(".container h1, .container p");
            
            filter.style.backdropFilter = `blur(${scrollTop * 0.01}px)`;

            topLogoImgs.forEach((logo, index) => {
                if (!(isLogosAnimationRunning)) {
                    logo.style.opacity = Math.max(1 - (scrollRatio * (topLogoImgs.length - index) * .5), 0);
                }
            });

            topTitles.style.transform = `translateY(${scrollTop * -1}px)`;
        }

        d.addEventListener("scroll", scrollEvent);

    </script>
</body>
</html>